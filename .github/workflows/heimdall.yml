name: heimdall

on: [push]

jobs:
  heimdall-gen2:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: 16
      - run: npm install yarn -g && yarn global add apollo
      - uses: nick-invision/private-action-loader@v3
        with:
          pal-repo-token: ${{ secrets.REPO_TOKEN }}
          pal-repo-name: snek-shipyard/heimdall-action
          # the following input gets passed to the private action
          structure-url: 'https://origin.snek.at/graphql/'
          data-url: 'https://dev.kanbon.cloud/graphql/'
          storage-path: ${{ github.workspace }}/.private-action/storage.crypto
          storage-encryption-key: ${{ secrets.STORAGE_ENCRYPTION_KEY }}
          drop-hash: ${{ github.sha }}
